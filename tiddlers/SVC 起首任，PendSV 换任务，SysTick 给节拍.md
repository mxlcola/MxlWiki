åœ¨ FreeRTOS çš„ Cortex-M ç«¯å£ä¸­ï¼Œ[[SVCä¸­æ–­]] åªè´Ÿè´£â€œå¯åŠ¨ç¬¬ä¸€ä¸ªä»»åŠ¡â€ã€‚
å®ƒä¸ä¼šå‚ä¸åç»­ä»»åŠ¡åˆ‡æ¢ï¼Œåç»­è°ƒåº¦éƒ½æ˜¯ç”± [[PendSVä¸­æ–­]]å®Œæˆçš„


## ğŸ§© ä¸€ã€`vPortSVCHandler()` çš„èŒè´£ â€”â€” å¯åŠ¨ç¬¬ä¸€ä¸ªä»»åŠ¡

åœ¨è°ƒç”¨ `vTaskStartScheduler()` æ—¶ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œï¼š

```
xPortStartScheduler()
 â””â”€â”€ vPortStartFirstTask()
      â””â”€â”€ SVC 0
```

`SVC 0` æŒ‡ä»¤è§¦å‘ **SVC å¼‚å¸¸**ï¼Œè¿›å…¥ `vPortSVCHandler()`ã€‚
è¿™ä¸ª SVC å¼‚å¸¸åªæ‰§è¡Œä¸€æ¬¡ï¼Œç”¨æ¥ï¼š

1. ä»å…¨å±€å˜é‡ `pxCurrentTCB` å–å‡ºå½“å‰ä»»åŠ¡ï¼ˆç¬¬ä¸€ä¸ªä»»åŠ¡ï¼‰çš„æ ˆæŒ‡é’ˆï¼›
2. æ¢å¤è¯¥ä»»åŠ¡ä¿å­˜çš„ä¸Šä¸‹æ–‡ï¼ˆR4â€“R11 + PSPï¼‰ï¼›
3. å¼‚å¸¸è¿”å›ï¼Œè®©ç¡¬ä»¶è‡ªåŠ¨å¼¹å‡ºå‰©ä½™å¯„å­˜å™¨ï¼ˆR0â€“R3ã€R12ã€LRã€PCã€xPSRï¼‰ï¼›
4. CPU â€œè½åœ°â€åˆ°ç¬¬ä¸€ä¸ªä»»åŠ¡çš„å…¥å£å‡½æ•°ï¼Œå¼€å§‹è¿è¡Œã€‚

ä¹‹åè°ƒåº¦å™¨å¼€å§‹å·¥ä½œï¼Œ**SVC Handler ä¸å†è¢«è°ƒç”¨**ï¼ˆé™¤éç”¨æˆ·è‡ªå·±ç”¨ `SVC` æŒ‡ä»¤è§¦å‘åˆ«çš„æœåŠ¡ï¼‰ã€‚

---

## âš™ï¸ äºŒã€åç»­çš„ä»»åŠ¡åˆ‡æ¢ç”±è°è´Ÿè´£ï¼Ÿ

ä»ç¬¬äºŒæ¬¡åˆ‡æ¢å¼€å§‹ï¼ˆå³ä»ä¸€ä¸ªä»»åŠ¡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ï¼‰ï¼Œæ˜¯ç”±ï¼š

> **[[PendSVä¸­æ–­]]ï¼ˆ`vPortPendSVHandler()`ï¼‰** å®Œæˆçš„ã€‚

* **SysTick** æˆ–å…¶å®ƒä¸­æ–­è§¦å‘è°ƒåº¦è¯·æ±‚ â†’ è®¾ç½® PendSV æŒ‚èµ·ï¼›
* CPU é€€å‡ºä¸­æ–­åæ‰§è¡Œ PendSVï¼›
* `vPortPendSVHandler()` ä¿å­˜å½“å‰ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ã€åˆ‡æ¢æ ˆæŒ‡é’ˆã€æ¢å¤ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼›
* å¼‚å¸¸è¿”å›å CPU è‡ªåŠ¨æ¢å¤ä¸‹ä¸€ä¸ªä»»åŠ¡ç°åœºã€‚

> ç®€è¨€ä¹‹ï¼š
>
> * **SVC**ï¼šåªåœ¨å¯åŠ¨é˜¶æ®µï¼Œç”¨æ¥â€œè¿›å…¥ç¬¬ä¸€ä¸ªä»»åŠ¡â€ï¼›
> * **PendSV**ï¼šåœ¨è¿è¡Œé˜¶æ®µï¼Œè´Ÿè´£â€œä»»åŠ¡ä¹‹é—´çš„åˆ‡æ¢â€ï¼›
> * **SysTick**ï¼šè´Ÿè´£å‘¨æœŸæ€§ tick ä¸­æ–­ï¼Œé©±åŠ¨è°ƒåº¦æ—¶æœºã€‚

---


## ğŸ§  ä¸‰ã€Cortex-M FreeRTOS ä¸‰å…„å¼Ÿåˆ†å·¥é€Ÿè®°

| å¼‚å¸¸          | åç§°                    | ä½œç”¨         | è°ƒç”¨æ—¶æœº                           |
| ----------- | --------------------- | ---------- | ------------------------------ |
| **SVC**     | Supervisor Call       | å¯åŠ¨ç¬¬ä¸€ä¸ªä»»åŠ¡    | ä»…åœ¨ `vPortStartFirstTask()` æ—¶è§¦å‘ |
| **PendSV**  | Pendable Service Call | æ‰§è¡Œä»»åŠ¡ä¸Šä¸‹æ–‡åˆ‡æ¢  | æ¯æ¬¡è°ƒåº¦å‘ç”Ÿæ—¶                        |
| **SysTick** | System Tick           | ç³»ç»Ÿå¿ƒè·³ä¸­æ–­ï¼ˆæ—¶åŸºï¼‰ | å‘¨æœŸè§¦å‘ï¼Œå¯èƒ½å¼•å‘ä»»åŠ¡åˆ‡æ¢                  |

---



âœ… **æ€»ç»“ä¸€å¥è¯**

> `vPortSVCHandler()` = **â€œä¸€é”®å¯åŠ¨ç¬¬ä¸€ä¸ªä»»åŠ¡â€**
> ä¹‹ååˆ‡æ¢éƒ½ç”± `vPortPendSVHandler()` è´Ÿè´£ã€‚



